{% extends "master.html" %}
{% block title %}POPVOX - Member of Congress{% endblock %}
{% block title2 %}{% endblock %}
{% block description %}See how your representative and senators voted on bills you have weighed in on.{% endblock %}
{% block subnav %}{% include "popvox/home_user_subnav.html" %}{% endblock %}
{%block nav_citzen_class_home%}active{%endblock%}
{% block content %}
<script>
	function showdata(is_first_load, is_more) {
		$('#options_state').val(report_state);
		$('#options_district').val(report_district);
		$('#options_state, #options_district').prop('disabled', true);
		$('#options_jump_nation, #options_jump_local').hide();
		
		update(true);
		
		isloading = true;
		
		$('#loadingstatus').text("Loading...");
		
		var pro_loading;
		var con_loading;
		if (is_more) {
			pro_loading = $("<p>Loading...</p>");
			$('#comments_pro').append(pro_loading);
			
			con_loading = $("<p>Loading...</p>");
			$('#comments_con').append(con_loading);
		}
		
		$.ajax({
			type:"GET",
			url: "/ajax{{bill.url}}/report/getinfo",
			data: {
				state: report_state,
				district: report_district,
				start: (!is_more ? 0 : start),
				count: count
			},
			complete: function(res, status) {
				isloading = false;
				
				$('#loadingstatus').text("");
				$('#options_state, #options_district').prop('disabled', false);
				
				if (status != "success") {
					$('#shortmessages').text("Error loading report.");
					return;
				}
				
				if (report_state == default_state && report_district == default_district) {
					$('#options_jump_nation').show();
				} else {
					$('#options_jump_local').show();
				}
				
				res = eval('(' + res.responseText + ')');
				
				if (res.debug_info)
					$('#debug_info').text(res.debug_info);
				
				$('#reporttitle').text(res.reporttitle);
				if (res.reportsubtitle == "") {
					$('#reportsubtitle').fadeOut();
				} else {
					$('#reportsubtitle').fadeIn();
					$('#reportsubtitle').text(res.reportsubtitle);
				}
				
				c_pro = $('#comments_pro');
				c_con = $('#comments_con');
				
				if (!res.pro_more) $('#comments_pro_more').hide(); else $('#comments_pro_more').show();
				if (!res.con_more) $('#comments_con_more').hide(); else $('#comments_con_more').show();
				
				if (!is_more) {
					c_pro.html("");
					c_con.html("");
				} else {
					pro_loading.remove();
					con_loading.remove();
				}
				
				var n_pro = 0, n_con = 0;
				for (var i = 0; i < res.comments.length; i++) {
					c = res.comments[i];
					
					var elem = $('#comment_template div.comment').clone();
					
					elem.find("h4 span.username").text(c.user)
					if (c.location)
					elem.find("h4 span.location").html("in <a href='/district/"+c.state+"/"+c.district+"/'>" + c.location + "</a>")
					else
						elem.find("h4 span.location").text("")
					elem.find("h4 span.date nobr").text(c.date);
					elem.find(".share a").attr("href", c.share);

					elem.find("p").text('');
					var msgpars = c.msg.split("\n");
					for (var j = 0; j < msgpars.length; j++) {
						var par = $('<div style="margin-bottom: 5px"/>');
						par.text(msgpars[j]);
						elem.find("p").append(par);
					}
					//elem.find("p").html(elem.find("p").html().replace("\n", "<br/><br/>"))

					if (c.verb != "supported" && c.verb != "opposed")
						elem.find(".verb").text(c.verb + " this bill");
					elem.find(".endorse_oppose_image").addClass((c.pos == "+") ? "endorse" : "oppose")
					if (res.can_appreciate == "both" || res.can_appreciate == c.pos) {
						elem.find(".appreciate a").attr("commentid", c.id);
						elem.find(".appreciate a").text((!c.appreciated ? "appreciate" : "appreciated"));
						if (c.appreciated) elem.find(".appreciate").addClass("active");
						elem.find(".appreciate span.text").hide();
					} else if (res.can_appreciate == "none") {
						elem.find(".appreciate a").hide();
						elem.find(".appreciate span.text").text("appreciation");
						elem.find(".appreciate span.text").attr("title", "you must weigh in on the bill first");
					} else if (res.can_appreciate == "+") {
						elem.find(".appreciate a").hide();
						elem.find(".appreciate span.text").text("appreciation");
						elem.find(".appreciate span.text").attr("title", "only opposing users can appreciate this comment");
					} else if (res.can_appreciate == "-") {
						elem.find(".appreciate a").hide();
						elem.find(".appreciate span.text").text("appreciation");
						elem.find(".appreciate span.text").attr("title", "only supporting users can appreciate this comment");
					}
					elem.find(".appreciate span.num").text(c.appreciates);
					elem.appendTo((c.pos == "+") ? c_pro : c_con);
					
					if (c.pos == "+") n_pro++; else n_con++;
				}
				if (n_pro == 0)
					c_pro.append($("<p>No supporting comments have been left" + (report_district != "" ? " in this district" : (report_state != "" ? " in this state" : "")) + ".</p>"));
				if (n_con == 0)
					c_con.append($("<p>No opposing comments {% if bill.isAlive %}have been{% else %}were{% endif %} left" + (report_district != "" ? " in this district" : (report_state != "" ? " in this state" : "")) + "{% if not bill.isAlive %} during the time the bill was up for consideration in Congress{% endif %}.</p>"));
				
				if (is_more) return;
				
				function escapeHTML(text) {
					var div = document.createElement('div');
					var text = document.createTextNode(text);
					div.appendChild(text);
					return div.innerHTML;
				}
				
				function buildchart(stats, index, islast) {
					$('#chart' + index).show(); // must come before chart load so dimensions get set right
				
					if (!islast) $('#chart' + index).addClass("chart_notlast");
					else $('#chart' + index).removeClass("chart_notlast");

					if (stats.total == 0) {
						$('#chart' + index).addClass("no_pie");
						$('#chart' + index + " .past_stats").hide();
						$('#chart' + index + ' .pro_reintro').show();
						$('#chart' + index + ' .pro_reintro').text(stats.pro_reintro + " individuals in " + stats.longdescription + " support reintroduction of the bill.");
						return;
					} else {
						$('#chart' + index).removeClass("no_pie");
						$('#chart' + index + " .past_stats").show();
					}
					
					$('#chart' + index + " .chart_title").text(stats.longdescription);
					$('#chart' + index + " .users").text("(" + stats.total + " people)");
					$('#chart' + index + " .bg_support").text(stats.pro_pct + "% Support");
					$('#chart' + index + " .bg_oppose").text(stats.con_pct + "% Oppose");
					
					if (stats.pro_reintro == 0) {
						$('#chart' + index + ' .pro_reintro').hide();
					} else {
						$('#chart' + index + ' .pro_reintro').show();
						$('#chart' + index + ' .pro_reintro').text(stats.pro_reintro + " people support reintroduction of the bill.");
					}
					
					bill_chart('chart_pie_' + index, stats.pro_pct, stats.con_pct, { "small": true });
					bill_timeseries('chart_time_' + index, stats.timeseries);
				}

				$('#stats_overall_info').text("");
				if (!res.stats) {
				} else if (res.stats.district) {
					buildchart(res.stats.district, 0);
					buildchart(res.stats.state, 1);
					buildchart(res.stats.overall, 2, true);
				} else if (res.stats.state) {
					if (report_district != "" && report_district != "0")
						$('#stats_overall_info').text("Not enough individuals from the Congressional district have commented on {{bill.proposition_type}} bill to display a chart for the district." + (res.stats.state.total > 0 ? " Charts for the state and nation are displayed instead." : ""));
					buildchart(res.stats.state, 0);
					buildchart(res.stats.overall, 1, true);
					$('#chart2').hide();
				} else if (res.stats.overall) {
					if (report_district != "")
						$('#stats_overall_info').text("Not enough individuals from the state have commented on this {{bill.proposition_type}} to display a chart for the district or state." + (res.stats.overall.total > 0 ? " A chart for the nation is displayed instead." : ""));
					else if (report_state != "")
						$('#stats_overall_info').text("Not enough individuals from the state have commented on this {{bill.proposition_type}} to display a chart for the state." + (res.stats.overall.total > 0 ? " A chart for the nation is displayed instead." : ""));
					buildchart(res.stats.overall, 0, true);
					$('#chart1').hide();
					$('#chart2').hide();
				} else {
					$('#stats_overall_info').text("Not enough individuals have commented on this {{bill.proposition_type}} to display a chart.");
				}

				if ((is_first_load || !report_state || res.comments.length == 0) && res.stats.overall) {
					$('#map').show();
					$('#showmap').hide();
				} else {
					$('#map').hide();
					if (res.stats.overall) $('#showmap').show();
				}
				
				function fill_table(elemid, dataarray, colnames) {
					if (!dataarray || !dataarray.length) {
						$(elemid).hide();
					} else {
						$(elemid).show();
						var tbody = $(elemid).find("tbody");
						tbody.text("");
						for (var i = 0; i < dataarray.length; i++) {
							var row = $("<tr/>");
							for (var j = 0; j < colnames.length; j++) {
								var cell = $("<td/>").text(dataarray[i][colnames[j]]);
								if (j > 0) cell.attr("style", "text-align: right");
								row.append(cell);
							}
							tbody.append(row);
						}
					}
				}

				fill_table("#by_town", res.stats.by_town, ["name", "+", "-"])
				fill_table("#by_source", res.stats.by_source, [0, 1])
			}
		});

	}

	function more_sponsored_bills() {
		if (isloading) return false;
		spons_start = spons_count;
		count += 20;
		showspons(false, true);
		return false;
	}
</script>
<div id="distsubnav" style="text-align:right">
					State 
					<select id="mem_options_state" size="1" onchange="mem_report_state = this.value; mem_update()">
						<option value="">Choose a state</option>
						{% for stateabbr, statename in stateabbrs %}<option value="{{stateabbr}}">{{stateabbr}} - {{statename}}</option>{% endfor %}
					</select>
					Member
					<select id="mem_options_member" size="1" onchange="mem_report_member = this.value; mem_update()">
				</select><a id="memgo" href="#">View Now</a></div>
<script type="text/javascript" src="/media/js/highcharts.js"></script>
<script type="text/javascript" src="/media/js/charts.js"></script>

<div class="content myhill memberpage">

	<div class="col_12 col_top col_last ">
		<h1 class="rule_btm">Member of Congress <span class="name">/ {{member.name}}</span></h1>
		
		<!--<h3>How Did Your Members of Congress Vote?</h3>
		<p>Are your senators and representative voting the way you want them to? Here is a personalized grid that displays every bill on which you weighed in, along with how your legislators voted if a vote was held on the bill. That includes letting you know if your Member of Congress abstained or was absent.  </p> -->
	</div>
	<div class="clear"> </div>
	<div class="member">
        {% if memdata.nophoto %}
          <div class="member-photo"><img
          src="/media/master/nophoto-{{memdata.gender}}.jpg" alt="{{member.name}}"/></div>
		{% else %}
          <div class="member-photo"><img
          src="/static/member_photos/{{member.id}}-200px.jpeg" alt="{{member.name}}"/></div>
        {% endif %}
		
		<p><span class="member_name">{{memdata.title}} {{memdata.firstname}} {{memdata.lastname}}</span> <span class="member_partydata">[{%if memdata.chamber == "house" %}{%if memdata.state == "DC" or memdata.state == "PR" %}<a href="/district/{{memdata.state}}">{{memdata.party}}, {{memdata.state}}</a>{% else %}<a href="/district/{{memdata.state}}/{{memdata.district}}">{{memdata.party}}, {{memdata.state}}-{{memdata.district}}</a>{% endif %}{% else %}<a href="/state/{{memdata.state}}">{{memdata.party}}, {{memdata.state}}</a>{% endif %}]</span></p>
	<div class="member-stats">
		<h3>Member Stats</h3>
		<table>
			{% if memdata.committees %}<tr><th>Committees</th>
				<td><ul>{% for committee in memdata.committees %} <li>{{ committee }}</li> {% endfor %}</ul> {% endif %}</td></tr>
			<tr><th>Age</th><td>{{ memdata.age }}</td></tr>
			<tr><th>Birth Date</th>	<td>{{ memdata.birthday|date:"m/d/Y" }}</td></tr>
		</table>
	</div><!--end member-stats -->
	</div><!--end member -->
	
	<div class="member-legislation">
	       <h2>Legislation</h2>
			   <div class="legislation-tabs">
				   <h4 class="active" id="sponsoredtab"><a href="void(0)" >Sponsored</a></h4>
				   <h4 class="inactive" id="cosponsoredtab"><a href="void(0)" >Co-Sponsored</a></h4>
				   <div style="clear:both;"></div>
				</div>
				   <div style="clear:both"></div>
	       <div class="sponsoredbills" id="sponsoredbills">
	               {% for bill,scope,pro,con,total in sponsored %}
	                   {% if forloop.first %}<ul>{% endif %}
	                            <li class="bill">
								<h4><a href="{{bill.url}}">{{ bill.nicename|truncatewords:12 }}</a></h4>
								{% if pro or con %}
									<a href="{{bill.url}}/report">
	                           			<div id="sponsoredtwo_part_bar_{{forloop.counter}}" class="bar_graph"><script>two_part_bar_chart("sponsoredtwo_part_bar_{{forloop.counter}}", {{pro|floatformat}}, {{con|floatformat}}, { bg: "#D4D1CA", nopad: true, left_label: "Support", right_label: "Oppose" });</script></div>
							   		</a>
								<p class="usercount">sentiment of {{total}} users in {{memdata.title}} {{memdata.firstname}} {{memdata.lastname}}'s {{scope}}</p>
								{% else %}
								<p class="toofew">Too few of {{memdata.title}} {{memdata.firstname}} {{memdata.lastname}}'s constituents have commented on {{bill.shortname}} to display statistics.</p>
									<p class="takeaction">For comments left so far <a href="{{bill.url}}/report">view  the report.</a></p>
								{% endif %}
	                              </li>
	                    {% if forloop.last %}</ul>{% endif %}
	                {% empty %}
	                <p>This member has not sponsored any bills</p>
	                {% endfor %}
	                </div><!--end sponsored -->
	       <div class="co-sponsored" id="cosponsoredbills">
	       {% for bill,scope,pro,con,total in cosponsored %}
	            {% if forloop.first %}<ul>{% endif %}
	                            <li class="bill">
								<h4><a href="{{bill.url}}">{{ bill.nicename|truncatewords:12 }}</a></h4>
								{% if pro or con %}
									<a href="{{bill.url}}/report">
	                					<div id="cosponsored_bar_{{forloop.counter}}" class="bar_graph"><script>two_part_bar_chart("cosponsored_bar_{{forloop.counter}}", {{pro|floatformat}}, {{con|floatformat}}, { bg: "#D4D1CA", nopad: true, left_label: "Support", right_label: "Oppose" });</script></div></a>
								<p class="usercount">sentiment of {{total}} users in {{memdata.title}} {{memdata.firstname}} {{memdata.lastname}}'s district</p>
								{% else %}
									<p class="toofew">Too few {{memdata.title}} {{memdata.firstname}} {{memdata.lastname}}'s constituents have commented on {{bill.shortname}} to display statistics.</p>
									<p class="takeaction">For comments left so far <a href="{{bill.url}}/report">View report.</a></p>
								{% endif %}
	             </li>
	            {% if forloop.last %}</ul>{% endif %}
	        {% empty %}
	        <p>This member has not co-sponsored any bills</p>
	        {% endfor %}
	        </div><!--end co-sponsored -->
	</div><!--end member-legislation -->

    <div class="member-info">
	<h2>Info</h2>
	<div class="member-info-inner">
	<h3>Web</h3>
		{% if memdata.website %}<a href="{{memdata.website}}">{{memdata.website}}</a>{% endif %}
	<h3>Social</h3>
	<ul class="social-links">
	{% if memdata.facebook_id %}<li><a class="facebook" href="http://facebook.com/{{memdata.facebook_id}}"></a></li>{% endif %}
	{% if memdata.youtube_url %}<li><a class="youtube" href="{{memdata.youtube_url}}"></a></li>{% endif %}
	{% if memdata.twitter_id %}<li><a class="twitter" href="http://twitter.com/{{memdata.twitter_id}}"></a></li>{% endif %}
	{#comment {% if memdata.flickr_id %}<li><a class="flickr" href="http://flickr.com/photos/{{memdata.flickr_id}}">Flickr</a></li>{% endif %}{ #}
    {% if memdata.googleplus %}<li><a class="googleplus" href="{{memdata.googleplus}}">G Plus</a></li>{% endif %}
</ul>
{% if memdata.last_vid %}
<iframe width="280" height="170" src="http://www.youtube-nocookie.com/embed/{{memdata.last_vid}}" frameborder="0" allowfullscreen></iframe>{% endif %}
<hr>
{% if memdata.twitter_id %}
    <script charset="utf-8" src="http://widgets.twimg.com/j/2/widget.js"></script>
    <script>
    new TWTR.Widget({
      version: 2,
      type: 'profile',
      rpp: 10,
      interval: 30000,
      width: 'auto',
      height: 500,
      theme: {
        shell: {
          background: '#404045',
          color: '#ffffff'
        },
        tweets: {
          background: '#ffffff',
          color: '#000000',
          links: '#cc6b11'
        }
      },
      features: {
        scrollbar: true,
        loop: false,
        live: true,
        behavior: 'all'
      }
    }).render().setUser('{{memdata.twitter_id}}').start();
    </script>
{% endif %}

	<h3>Address</h3>
	<p>Washington, DC:<br/>
{{memdata.congress_office}}<br/>
Washington, DC 20515</p>
	</div></div><!--end member-info -->

<script>
$(document).ready(function($){
    $('.highcharts-container').each( function() {
        $(this).width($(this).parent().parent().width());
    });
    $('#cosponsoredbills').hide();


$('#cosponsoredtab').click(function show_cosponsored() {
	$('#cosponsoredbills').show();
	$('#sponsoredbills').hide();
	$('#cosponsoredtab').addClass("active");
	$('#cosponsoredtab').removeClass("inactive");
	$('#sponsoredtab').addClass("inactive");
	$('#sponsoredtab').removeClass("active");
	return false;
});
$('#sponsoredtab').click(function show_sponsored() {
	$('#cosponsoredbills').hide();
	$('#sponsoredbills').show();
	$('#cosponsoredtab').addClass("inactive");
	$('#cosponsoredtab').removeClass("active");
	$('#sponsoredtab').addClass("active");
	$('#sponsoredtab').removeClass("inactive");
	return false;
});
});
</script>
<script type="text/javascript" src="/media/js/gettoknow.js"></script>
{% endblock %}
