{% extends "master.html" %}
{% block title %}Organizations{% endblock%}
{%block nav_legstaff_class_orgs%}active{%endblock%}
{%block nav_orgadmin_class_orgs%}active{%endblock%}
{%block nav_citzen_class_orgs%}active{%endblock%}
{% block adunits %}{% include "ads/rightbar_head.html" %}{% endblock %}
{% block head %}
<script>
var last_issue_elem = null;
function showlist(elem, issueslug) {
	$('#activity').hide();
	$('#orglist_title').text($(elem).text() + " organizations:");
	$('#orglist_list').text('');
	if (last_issue_elem) $(last_issue_elem).removeClass('active');
	$(elem).addClass('active');
	last_issue_elem = elem;
	$('#orglist_status').text("Loading...");
	ajax(
		'ajax/orgs/search',
		{ "issue": issueslug, "format": "json" },
		{
			statusfield: "orglist_status",
			success: function(ret) {
				$('#orglistloading').hide();
				var lst = $('#orglist_list');
				lst.text('');
				for (orgx in ret.orgs) {
					var org = ret.orgs[orgx];
					var tn = document.createTextNode(org.label);
					var an = document.createElement("a");
					an.setAttribute("href", org.url);
					an.appendChild(tn);
					var ln = document.createElement("li");
					ln.appendChild(an);
					lst.append(ln);
					if (!org.createdbyus)
						an.setAttribute("class", "notcreatedbyus");
				}
				
				max_scroll = $('#orglist_title').offset().top - 30;
				if ($(window).scrollTop() > max_scroll) $(window).scrollTop(max_scroll);
				
				$('#orgnote').show();
			}
		}
		);
	return false; // cancel click
}
$(function() {
	$.ajax({
		type:"POST",
		url: "/ajax/activity",
		data: {
			comments: false,
			count: 8
		},
		complete: function(res, status) {
			$('#activity').html(res.responseText);
		}
	});
});
</script>
{% endblock %}
{% block content %}
	<div class="content">

		<div class="col_9 col_top">
			<div class="">
				<h1>Organization Directory</h1>
				<div class="block bill_search">
					<div class="search_box">
						<input id="orgsearchbox" type="text" class="search" value="search for an organization"  onfocus="if (this.value=='search for an organization') this.value='';"/>
						<span>Start typing the name of an organization</span>	
					</div>
				    <script>
				    $(document).ready(function(){
						  $("#orgsearchbox").autocomplete({
						  	source: "/ajax/orgs/search",
							select: function(event, ui) {
								location.href = "/orgs/" + ui.item.slug;
							}
						  });
				    });
				    </script>
				</div>
			</div>
			
			<div class="block orgs rule">
				<h2>Browse by Issue Area</h2>
			
				<div class="col_50">
					
					<ul class="issue_list">
					   {% for issue in issueareas %}
						  <li>
							<a href="#" onclick="return showlist(this, '{{issue.slug|escapejs}}')">{{ issue.name }}</a>
						</li>
					   {% endfor %}
					  </ul>
				</div>
				
				<div class="col_50 col_last">
					<h4 id="orglist_title">Recently updated organizations:</h4>
					<p id="orgnote" class="pad_top" style="display: none">(Entries in bold indicate information reported by the organization itself.)</p>
					<div id="orglist_status"></div>
					<ul id="orglist_list" class="org_all">
					</ul>
					<div id="activity" style="margin-top: 1.5em"></div>
				</div>
			</div>
		</div>

		{% include "ads/rightbar.html" %}

		<div class="col_3 col_last">
			{% if user.is_anonymous %}
			<div class="hr2"> </div>
			<p><small>Don&rsquo;t see your organization on POPVOX? Any U.S. nonprofit can <a href="/accounts/register/orgstaff">get listed</a>.</small></p>
			{% endif %}
		</div>

    </div>
{% endblock %}

