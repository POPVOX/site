{% comment %} This is the lightbox that appears on the comment share page when we need to ask the user to set a screen name and password.{% endcomment %}
<div style="display: none">
	<div id="writecongress_followup" class="colorbox" style="width: 540px">
		<h1>Set Up Your POPVOX Account</h1>
	
		<p>Thank you for sharing your opinion using the Write Congress tool from POPVOX.</p>
		
		<p>At this time you can set up your POPVOX account which will let you revise and track the status of your comments on legislation before Congress.</p>
		
		<form class="form" onsubmit="return do_submit_screename_password(false);">
			{% csrf_token %}
			<label for="email">email address</label>
			<input type="text" class="c3" id="email" name="email" value="{{user.email}}" disabled="1"/>
			<small>Your email address will not be shown publicly or shared with third parties.</small>
			
			<label for="password">password</label>
			<input type="password" class="c3" id="password"/><br />

			<label for="password2">password again</label>
			<input type="password" class="c3" id="password2"/><br />
			<div id="errorlabel_password" class="error"> </div>

			<label for="username">screen name</label>
			<input type="text" size="20" id="username" name="username" value="{{user.username}}"/>
			<small>your screen name is how you are known to others visiting POPVOX</small>
			<div id="errorlabel_username" class="error"> </div>
			
			<p id="errorlabel" class="error" style="display: block">{{error}}</p>
			
			<input id="submitbutton" type="submit" class="submit" value="Continue"/>
			
			<input type="button" class="submit" value="Skip" onclick="$.colorbox.close();"/>
		</form>
	</div>
</div>
		
<script>
$('#username, #password, #password2').keyup_delayed(function() { do_submit(true) });

function do_submit_screename_password(validate) {
	if ($('#password').val() != $('#password2').val() && (!validate || $('#password2').val() != "")) {
		$('#errorlabel_password').show();
		$('#errorlabel_password').text("The two password fields don't match.");
		return false;
	}
	
	ajaxform("/ajax/accounts/profile/updatefields",
		{ "validate": (validate ? "validate" : "") },
		{
			"username": "#username",
			"password": "#password",
		},
		{
			statusfield: "errorlabel",
			savebutton: "submitbutton",
			success: function(res) {
				if (!validate)
					$.colorbox.close();
			}
		}
		);

	return false;	
}

$(function() {
	$.colorbox({inline: true, href:"#writecongress_followup", width: 620, height: 550, transition: "none" })
});
</script>

