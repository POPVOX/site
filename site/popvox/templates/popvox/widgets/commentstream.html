{% load humanize %}
{% load popvox_utils %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head profile="http://gmpg.org/xfn/11">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" /><!--[if lte IE 7]><meta http-equiv="X-UA-Compatible" content="chrome=1"><![endif]--> 
		
	<title>comment stream widget - {{title1}} {{title2}} // POPVOX</title>
	
	<link rel="stylesheet" href="/media/widget/widget_comment.css" type="text/css" media="screen" />

	<script type="text/javascript" src="/media/js/jquery.js"></script>
	
	<style>
	{% if request.GET.iframe %}
	body {
		padding: 0;
		margin: 0;
		overflow: hidden;
	}
	#widget_body {
		overflow: hidden;
	}
	{% endif %}

	
	{% if "widget_theme" in permissions %}
	#comment_widget #widget_top {
		background: #{{request.GET.sbg}}; /* url("comments_widget_head_grad.png") left top repeat-x; */
		color: #{{request.GET.sfg}};
		border: #000;
		}
		
	#comment_widget #widget_body {
		background: #{{request.GET.bg}}; /* url("bg_widget_comment_body_grad_2.png") repeat-x scroll left top; */
		}
		
	#comment_widget h1,
	#comment_widget h2 {
		text-shadow: none;
		color: #{{request.GET.sfg}};
		}
		
	#comment_widget p.share a {	
		color: #{{request.GET.lnk}};
		}
	
	#comment_widget p {
		color: #{{request.GET.fg}};
		}
		
	#comment_widget .comment {
		border-bottom: none;
		}
		
	#comment_widget #widget_foot, #comment_widget #widget_foot p a {
		background: #{{request.GET.sbg}};
		color: #{{request.GET.sfg}};
		}
	{% endif %}
	
	</style>
	
	<script>
	var scroll_delay = 9000;
	
	$(function() {
			{% if request.GET.client != 'anaap' %}	
			$('#widget_top').css("height", ($('#widget_top h1').height() + $('#widget_top h2').height() + 15) + "px");			
			{% endif %}

			{% if request.GET.client != 'anaap' %}			
			{% if request.GET.iframe %}
			$('#widget_body').css("height", ($(window).height() - $('#widget_top').height() - $('#widget_foot').height() - 25) + "px");
			{% endif %}
			{% endif %}
			
			if (scroll_delay) window.setTimeout("scroll_comments()", scroll_delay);
	});
	
	function scroll_comments() {
		var nodes = $("#widget_body .widget_item");
		if (nodes.length <= 1) return;
		var node = nodes[0];
		$(node).animate({
			//opacity: 0, // not so good in IE
			height: 0,
			"margin-bottom": 0
		}, 1500,
			// called after animation completes
			function() {
				// move node to the end
				node.parentNode.appendChild(node);
				$(node).css({ opacity: 100, height: "auto", "margin-bottom": "10px" }); // reset
				
				// next
				window.setTimeout("scroll_comments()", scroll_delay);
			});
	}
	</script>

</head>
<body>
	<div id="wrap">
		<div id="comment_widget" class="float_left">
			{% if request.GET.client == 'anaap' %}
				<div id="widget_top" style='height:24px; line-height: 10px;'>
			{% else %}
				<div id="widget_top">
			{% endif %}

				{% if request.GET.client == 'anaap' %}
					<h1 style='text-align: center; line-height: 10px;'>{{title1}}</h1>
				{% else %}
					<h1>{{title1}}</h1>
				{% endif %}
				{% if request.GET.client != 'anaap' %}
					{% if url %}
						<h2><a href="{{url}}" target="_blank">{{title2|truncate:80}}</a></h2>
					{% else %}
						<h2>{{title2|truncatewords:10}}</h2>
					{% endif %}
				{% endif %}
			</div>
			
			{% if request.GET.client == 'anaap' %}
				<div id="widget_body" style='height: 230px;'>
			{% else %}
				<div id="widget_body">
			{% endif %}
				{% for item in comments %}

				<div class="widget_item">
				{% if show_bill_number %}
				<h3><a href="https://www.popvox.com{{item.bill.url}}" target="_blank">{{item.bill.title|truncatewords:12}}</a></h3>
				{% endif %}
				
				<p>
					<span class="username">{{item.user.username}}</span>
					from
					{{item.address.statename}}{% if item.address.congressionaldistrict > 0 %}&rsquo;s {{item.address.congressionaldistrict|ordinal_html}} district{% endif %}
				</p>
	
				<div class="comment">
					<div class="usercomment endorse_oppose_image {% if item.position == "+" %}endorse{% endif %} {% if item.position == "-" %}oppose{% endif %}">
						<div class="icon"></div>
						{{item.message|wraplines:"p"|truncatewords_html:50}}
						<p class="share"><span class="date">{% display_date item.updated %}</span> <a href="https://www.popvox.com{{item.url}}" target="_blank">view &amp; share</a></p>
						<div class="clear"> </div>
					</div>
				</div><!-- e: comment -->
				</div><!-- e: widget_item -->
				
				{% empty %}
				
					<div class="comment">
						<p>There are no comments to display.</p>
					</div>
				
				{% endfor %}
			</div><!-- e: body -->

			{% if request.GET.client != 'anaap' %}
			<div id="widget_foot">
				<p><a href="https://www.popvox.com/legal#privacypolicy" target="_blank">privacy</a> | <a href="{% if url %}{{url}}{% else %}http://www.popvox.com{% endif %}" target="_blank">read more</a></p>
			</div>
			{% else %}
			<div id="widget_foot" style='padding-top:8px; padding-bottom:12px;background:#fafafa; text-align:center;'>
				<a style='display:inline-block; height:23px;line-height:23px; font-family: Arial; background:#777; text-align: center; width: 180px; color: #fff; text-decoration:none; font-size:11px; text-transform: uppercase;-webkit-border-radius: 12px;-moz-border-radius: 12px; o-border-radius: 12px;-ms-border-radius: 12px;border-radius: 12px;' href='{% if url %}{{url}}{% else %}http://www.popvox.com{% endif %}'>Read More</a>
			</div>
			{% endif %}
			
		</div><!-- e: widget -->
	</div><!-- e: wrap -->
</body>
</html>
