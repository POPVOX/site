{% extends "master.html" %}
{% load popvox_utils %}
{% block title %}Preview Comment on {{ bill.title }}{% endblock%}
{%block nav_citzen_class_bills%}active{%endblock%}
{% block head %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
{% endblock %}
{% block content %}
<div class="content">

	{% with "preview" as billcomment_progress_step %}
	{% include "popvox/billcomment_progress.html" %}
	{% endwith %}

	<div class="tab_pane">
	
	<form method="post" id="commentform">
	
	{% csrf_token %}
	<input id="submitmode" type="hidden" name="submitmode" value="Submit Comment >"/>
	<input type="hidden" name="message" value="{{message}}"/>
	<input type="hidden" name="district" value="{{district}}" id="districtfield"/>
	
	{% if not newaccount_error %}
		<div class="tip_inline mar_no">
			 <p>Writing your comment is the hardest step but you&rsquo;re doing great.
				Before we go on, read it over to make sure you are happy with it.
				(You can revise or remove your comment later.)</p>
		</div>
		<div class="clear"> </div>

		<h3>Preview Your Comment</h3>
		<div class="hr"> </div>
		
		<div class="message_preview">
			<h5>{% if position == "+" %}Support{% endif %}{% if position == "-" %}Oppose{% endif %} {{bill.displaynumber}}</h5>
			{{message|wraplines:"p"}}
		</div>
	
		{% if not user.is_authenticated %}
		<p class="pad_btm">You are not done until you register or sign in.</p>
		<p class="pad_btm">
			<input class="b_back btn" type="button" value="< Go Back" onclick="submitform('< Go Back')"/>
		</p>
		{% else %}
		<p class="">You are not done just yet. Click Next to locate your congressional district.</p>
		{% endif %}
	{% else %}
		<h1>Submit Your comment</h1>
	
	{% endif %}
		
	{% if not user.is_authenticated %}
	<div id="needsauth">
		<div class="col_4_5">
<!--			<h2>Sign-In or Sign-Up</h2> -->
			
			<h4>Sign Up</h4>
			
<!--			<p>We require everyone to create an account so we can prevent troublemakers from leaving many messages on the same legislation.</p> -->
			
			{% if not newaccount_error %}
			<p>Create an account instantly using one of these services:</p>
			<div class="signin_social" style="float: none">
			{% include "registration/login_singlesignon.html" %}
			</div>
			
			<p class="float_text"><a href="#" onclick="return false" id="create_account_more">Don't recognize this?</a></p>
			
			<p class="clear pad_top"><small>We will ask you later whether you want to post your comment to your account. It&rsquo;s optional.</small></p>
			
			{% endif %}
			
			{% more create_account %}
			<p id="create_account" class="clear mar_top pad_top">Fill out the following fields to create a POPVOX account:</a></p>
			
				<small>A POPVOX account is free and your public comments will be anonymous, but we will need your name and address later on so your comment gets to the right place in Congress.</small>
			<div class="clear mar_top"> </div>		

			<div class="form signinup">
				<label for="createacct_username">screen name</label>
				<input class="c2" type="text" name="createacct_username" value="{{username}}"/>
				<div id="createacct_errorlabel_username" class="error" style="display: block">{{newaccount_error.username}}</div>
			<small>Your screen name will be displayed next to your comment. It must be at least five characters and cannot contain spaces.</small>
				
				<label for="createacct_email">email address</label>
				<input class="c2" type="text" name="createacct_email" value="{{email}}"/>
				<div id="createacct_errorlabel_email" class="error" style="display: block">{{newaccount_error.email}}</div>
<!--			<small>Your email address will only be used to send you notifications about your account including to help you recover a lost password. It will not be shown publicly or shared with third parties.</small> -->

				<label for="createacct_password">password</label>
				<input class="c2" type="password" name="createacct_password" value="{{password}}"/>
				<div id="createacct_errorlabel_password" class="error" style="display: block">{{newaccount_error.password}}</div>
	
				<div class="error" id="createacct_errorlabel"></div>
			</div>
			<p class="b_create_box">
				<input class="b_create_accnt btn" type="button" value="Create Account >" onclick="submitform('Create Account >')"/>
			</p>
			{% endmore %}
			{% if newaccount_error %}
			<script>$(function() {$('#create_account').show()});</script>
			{% endif %}
		</div>
		
			<script>
			function trylogin() {
				ajax(
					"/registration/ajax/login",
					{ email: $('#login_email').val(), password: $('#login_password').val() },
					{
					statusfield: "login_errorlabel",
					success: function() {
						$('#login_errorlabel').text("Please wait...");
						window.location = "{{ singlesignon_next|escapejs }}";
					}
					}
				);
			}
			$(function() {
					$('#login_email, #login_password').keydown_enter(trylogin);
			});
			</script>
		
		<div class="col_4_3 col_last">
			<h4>Already A Member? Log In</h4>
			
			<p class="create_text">Login instantly using one of these services:</p>
			<div class="signin_social social_r">
				{% include "registration/login_singlesignon.html" %}
			</div>
			<div class="clear mar_top"> </div>
			
			<div class="form signinup">
				<p class="create_text">or provide your POPVOX email and password:</p>
			
				<label for="login_email">email</label>
				<input class="c2" type="text" id="login_email" value="{{email}}"/><br />
				<span id="login_errorlabel_email" class="error"></span>
				
				<label for="login_password">password</label>
				<input class="c2" type="password" id="login_password"/><br />
				<span id="login_errorlabel_password" class="error"></span>
				
				<input class="b_login btn" type="button" value="Login" onclick="trylogin()" class="submit"/>
				<div class="error" id="login_errorlabel"></div>
			</div>
		</div>
		
		<div class="clear"></div>
	</div>
	
	{% else %}
		
		<p class="mar_top pad_btm">
			<input class="b_back btn" type="button" value="< Go Back" onclick="submitform('< Go Back')"/>
			<input class="b_next btn" type="button" value="Next >" onclick="submitform('Next >')"/>
		</p>
			
	{% endif %}

	</form>
	
	<script>
	function submitform(mode) {
		$('#submitmode').val(mode);
		$('#commentform').submit();
	}
	</script>
	
	</div>
	
</div>
{% endblock %}

